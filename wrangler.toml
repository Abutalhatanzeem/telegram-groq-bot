export default {
  async fetch(request) {

    // ===== APNI KEYS YAHAN DAALO =====
    const BOT_TOKEN = "8704763332:AAG7B_POD4K2xEJMRWbwBR8nUL7mMeAtg24";
    const GROQ_API_KEY = "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";
    // ==================================

    if (request.method !== "POST")
      return new Response("‚úÖ Bot Running!");

    const update = await request.json();
    if (!update.message?.text) return new Response("OK");

    const chatId = update.message.chat.id;
    const userText = update.message.text;

    // /start command
    if (userText === "/start") {
      await sendMessage(BOT_TOKEN, chatId, 
        "Hello! üëã Main tumhara Groq AI Bot hoon!\nKuch bhi poochho ‚Äî main jawab dunga! ‚ö°");
      return new Response("OK");
    }

    // Groq AI se jawab lo
    const groqRes = await fetch("https://api.groq.com/openai/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${GROQ_API_KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "llama3-70b-8192",
        messages: [
          {
            role: "system",
            content: "Tum ek helpful assistant ho. Clear aur short jawab do. Hinglish mein baat kar sakte ho."
          },
          {
            role: "user",
            content: userText
          }
        ],
        max_tokens: 500
      })
    });

    const groqData = await groqRes.json();
    const reply = groqData.choices?.[0]?.message?.content || "‚ö†Ô∏è Kuch gadbad hui, dobara try karo!";

    await sendMessage(BOT_TOKEN, chatId, reply);
    return new Response("OK");
  }
}

// Helper Function
async function sendMessage(token, chatId, text) {
  await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ chat_id: chatId, text: text })
  });
}
